# FATS: A Fuzzing Filesystem using FUSE and Radamsa

FATS is a Python-based FUSE (Filesystem in Userspace) that acts as a passthrough filesystem with a twist: it fuzzes files on the fly. When a program attempts to open and read a file through the FATS mount point, it receives a mutated version of the original file, generated by the powerful fuzzer, [Radamsa](https://gitlab.com/akihe/radamsa).

This tool is designed for fuzz testing applications to discover bugs, crashes, and potential security vulnerabilities related to file parsing and handling.

## How It Works

FATS mounts a directory and mirrors its structure. While most filesystem operations (`ls`, `cd`, `stat`) are passed through to the original directory, the `open` system call is intercepted. When a file is opened, FATS:

1.  Takes the path to the requested file.
2.  Invokes `radamsa` to create a fuzzed copy of that file.
3.  Saves this mutated copy to a temporary location (`/tmp/`).
4.  Returns a file handle to the temporary, fuzzed file.

The application opening the file remains unaware of this substitution and proceeds to read the corrupted data, allowing you to observe its behavior under unexpected conditions.

## Dependencies

Before running FATS, ensure you have the following dependencies installed:

1.  **Python 3** (The script is also compatible with Python 2)
2.  **FUSE**: The core FUSE library for your operating system.
    * **Debian/Ubuntu**: `sudo apt-get install fuse libfuse-dev`
    * **Fedora/CentOS/RHEL**: `sudo dnf install fuse fuse-devel`
    * **macOS**: Install [macFUSE](https://osxfuse.github.io/).
3.  **fusepy**: The Python FUSE bindings.
    ```bash
    pip install fusepy
    ```
4.  **Radamsa**: The command-line fuzzer.
    * **Debian/Ubuntu**: `sudo apt-get install radamsa`
    * **macOS (Homebrew)**: `brew install radamsa`
    * It can also be built from [source](https://gitlab.com/akihe/radamsa).

## Usage

1.  **Save the script** to a file (e.g., `fats.py`) and make it executable:
    ```bash
    chmod +x fats.py
    ```

2.  **Prepare your directories:**
    * Create a directory with the files you want to use as fuzzing templates (`root_dir`).
    * Create an empty directory to serve as the mount point (`mount_point`).

    ```bash
    mkdir original_files
    mkdir mounted_fuzz
    cp /path/to/your/test/files/* original_files/
    ```

3.  **Run FATS:**
    Provide the root directory as the first argument and the mount point as the second.

    ```bash
    ./fats.py ./original_files ./mounted_fuzz
    ```
    The script will run in the foreground. Leave this terminal open.

4.  **Test an application:**
    In another terminal, run your target application, pointing it to a file inside the `mounted_fuzz` directory.

    ```bash
    # Example: Test the 'file' utility
    file ./mounted_fuzz/some_image.jpg

    # Example: Test a media player
    vlc ./mounted_fuzz/some_video.mp4
    ```
    Observe the application for crashes, hangs, or error messages. Each time you access a file, a new fuzzed version will be generated.

5.  **Unmount the filesystem:**
    To stop FATS, press `Ctrl+C` in the terminal where it is running. If the mount point becomes unresponsive, you can force unmount it with:
    ```bash
    fusermount -u ./mounted_fuzz
    ```
